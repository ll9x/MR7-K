<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ø«Ø¹Ø¨Ø§Ù† ÙˆØ§Ù„Ø³Ù„Ù… - Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f0f8ff;
            margin: 0;
            padding: 20px;
        }
        .welcome-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: white;
            text-align: center;
        }
        .welcome-title {
            font-size: 4em;
            font-weight: bold;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .name-input-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: white;
            text-align: center;
        }
        .input-container {
            background: rgba(255,255,255,0.1);
            padding: 40px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            min-width: 300px;
        }
        .input-group {
            margin: 20px 0;
            text-align: right;
        }
        .input-group label {
            display: block;
            margin-bottom: 10px;
            font-size: 1.2em;
            font-weight: bold;
        }
        .input-group input {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            background: rgba(255,255,255,0.9);
            color: #333;
            text-align: center;
        }
        .join-button {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.3em;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 15px rgba(0,0,0,0.2);
            margin-top: 20px;
        }
        .game-content {
            display: none;
        }
        #game-container {
            display: inline-block;
            margin: 20px auto;
            position: relative;
            width: 600px;
            height: 600px;
            background: #fff;
            border-radius: 20px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.2);
            overflow: hidden;
            margin-bottom: 20px;
        }
        #board {
            width: 100%;
            height: 100%;
            border-collapse: collapse;
            border-spacing: 0;
            position: relative;
        }
        #board td {
            position: relative;
            padding: 0;
            margin: 0;
            width: 10%;
            height: 10%;
            box-sizing: border-box;
        }
        .player {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            margin: 0 auto;
            position: absolute;
            z-index: 10;
            border: 2px solid white;
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
            transition: all 0.5s ease-in-out;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }
        .player1 {
            background-color: #e74c3c;
        }
        .player2 {
            background-color: #1b9ef5;
        }
        #controls {
            margin: 20px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #0943cb;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        #status {
            margin: 15px;
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
            min-height: 60px;
        }
        #dice {
            font-size: 28px;
            margin: 15px;
            padding: 15px;
            background-color: white;
            border: 2px solid #ddd;
            display: inline-block;
            width: 60px;
            border-radius: 10px;
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© */
        @media (min-width: 769px) and (max-width: 1024px) {
            /* Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù„ÙˆØ­ÙŠØ© */
            .welcome-title {
                font-size: 3.5em;
            }
            
            .welcome-subtitle {
                font-size: 1.3em;
            }
            
            .welcome-features {
                gap: 25px;
                margin: 30px 0;
            }
            
            .feature-card {
                min-width: 180px;
                padding: 18px;
            }
            
            .start-button {
                padding: 14px 35px;
                font-size: 1.2em;
            }
            
            #game-container {
                width: 70vw;
                height: 70vw;
                max-width: 500px;
                max-height: 500px;
            }
            
            .cell {
                font-size: 10px;
                padding: 2px;
            }
            
            .player {
                width: 16px;
                height: 16px;
                border-radius: 8px;
            }
            
            #controls {
                flex-direction: row;
                justify-content: center;
                gap: 15px;
                flex-wrap: wrap;
            }
            
            #controls button {
                padding: 10px 20px;
                font-size: 16px;
            }
        }
        
        @media (min-width: 1025px) {
            /* Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± */
            .welcome-screen {
                padding: 20px;
            }
            
            .welcome-features {
                max-width: 800px;
            }
            
            #game-container {
                width: 60vw;
                height: 60vw;
                max-width: 600px;
                max-height: 600px;
            }
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¹Ø§Ù…Ø© Ù„Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© */
        * {
            box-sizing: border-box;
        }
        
        body {
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        
        .welcome-screen {
            padding: 20px;
            min-height: 100vh;
        }
        
        #game-container {
            position: relative;
            margin: 0 auto;
        }
        
        #controls {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        #controls button {
            white-space: nowrap;
            min-width: 120px;
        }
    </style>
</head>
<body>
    <!-- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ -->
    <div id="welcomeScreen" class="welcome-screen">
        <div class="welcome-title">Snake MR7</div>
        <div class="welcome-title">ğŸ²Snake MR7ğŸ²</div>
        <div style="color: rgb(219, 241, 20); font-size: 1.5em; margin-bottom: 30px;">Mostafa Alrawi</div>
        <button class="join-button" onclick="showNameInput()">ğŸ® Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† ğŸ®</button>
    </div>
    
    <!-- ÙˆØ§Ø¬Ù‡Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„ØºØ±ÙØ© -->
    <div id="nameInputScreen" class="name-input-screen">
        <div class="input-container">
            <h2>ğŸ® Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ ØºØ±ÙØ© Ø§Ù„Ù„Ø¹Ø¨</h2>
            
            <div class="input-group">
                <label for="playerName">Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨:</label>
                <input type="text" id="playerName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§..." maxlength="20">
            </div>
            
            <div class="input-group">
                <label for="roomId">Ø±Ù‚Ù… Ø§Ù„ØºØ±ÙØ©:</label>
                <input type="text" id="roomId" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ØºØ±ÙØ©..." maxlength="10">
            </div>
            
            <button class="join-button" onclick="joinRoom()">Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ø§Ù„ØºØ±ÙØ©</button>
            
            <div style="margin-top: 20px; font-size: 0.9em; opacity: 0.8;">
                ğŸ’¡ Ù†ØµÙŠØ­Ø©: Ø´Ø§Ø±Ùƒ Ø±Ù‚Ù… Ø§Ù„ØºØ±ÙØ© Ù…Ø¹ ØµØ¯ÙŠÙ‚Ùƒ Ù„Ù„Ø¹Ø¨ Ù…Ø¹Ø§Ù‹
            </div>
        </div>
    </div>
    
    <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù„Ø¹Ø¨Ø© -->
    <div id="gameContent" class="game-content">
        <div id="game-container">
            <table id="board"></table>
            <div id="player1" class="player player1"></div>
            <div id="player2" class="player player2"></div>
        </div>
        <div id="controls">
            <div id="status">ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù†Ø¶Ù…Ø§Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø«Ø§Ù†ÙŠ...</div>
            <div id="dice">-</div>
            <button id="roll">Ø¥Ø±Ù… Ø§Ù„Ù†Ø±Ø¯</button>
            <button id="reset">Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
            <button onclick="showWelcome()" style="background: #e74c3c;">Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
        </div>
    </div>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯ Socket.IO
        const socket = io();
        
        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
        let currentPlayer = 1;
        let playerPositions = [1, 1];
        let gameOver = false;
        let myPlayerNumber = null;
        let myPlayerName = '';
        let roomId = '';
        let players = [];
        // Ù…ØªØºÙŠØ±Ø§Øª Ù…Ù†Ø·Ù‚ Ø§Ù„Ù„ÙˆØ­Ø©
        let snakes = [];
        let ladders = [];
        let negativeSquares = [];
        let positiveSquares = [];
        let isMoving = false;
        const ROWS = 10;
        const COLS = 10;
        const TOTAL_CELLS = ROWS * COLS;
        const MIN_SNAKES = 5;
        const MAX_SNAKES = 8;
        const MIN_LADDERS = 5;
        const MAX_LADDERS = 8;
        const MOVE_DELAY = 300; // ØªØ£Ø®ÙŠØ± Ø§Ù„Ø­Ø±ÙƒØ© Ø¨ÙŠÙ† Ø§Ù„Ø®Ù„Ø§ÙŠØ§ (Ø¨Ø§Ù„Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©)

        // --- Ø¯ÙˆØ§Ù„ ØªÙˆÙ„ÙŠØ¯ ÙˆØ±Ø³Ù… Ø§Ù„Ù„ÙˆØ­Ø© ---
        function generateSnakesAndLadders() {
            snakes = [];
            ladders = [];
            negativeSquares = [];
            positiveSquares = [];
            // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ø±Ø³ÙˆÙ…Ø§Øª Ù‚Ø¯ÙŠÙ…Ø©
            document.querySelectorAll('.connection, .connection-label, .negative-square, .positive-square').forEach(el => el.remove());
            // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø³Ù„Ø§Ù„Ù… (Ø®Ø·ÙˆØ· Ø®Ø¶Ø±Ø§Ø¡)
            const numLadders = getRandomInt(MIN_LADDERS, MAX_LADDERS);
            for (let i = 0; i < numLadders; i++) {
                let start, end;
                do {
                    start = getRandomInt(2, TOTAL_CELLS - 10);
                    end = getRandomInt(start + 5, Math.min(start + 20, TOTAL_CELLS));
                } while (ladders.some(l => l.start === start || l.end === end || Math.abs(l.start - start) < 5));
                ladders.push({start, end});
                drawConnection(start, end, 'ladder');
            }
            // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø«Ø¹Ø§Ø¨ÙŠÙ† (Ø®Ø·ÙˆØ· Ø­Ù…Ø±Ø§Ø¡)
            const numSnakes = getRandomInt(MIN_SNAKES, MAX_SNAKES);
            for (let i = 0; i < numSnakes; i++) {
                let start, end;
                do {
                    start = getRandomInt(10, TOTAL_CELLS);
                    end = getRandomInt(1, start - 5);
                } while (snakes.some(s => s.start === start || s.end === end || Math.abs(s.start - start) < 5));
                snakes.push({start, end});
                drawConnection(start, end, 'snake');
            }
            // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„Ø³Ø§Ù„Ø¨Ø© (ØªØ±Ø¬Ø¹ Ø§Ù„Ø®ØµÙ…)
            const numNegativeSquares = getRandomInt(3, 6);
            for (let i = 0; i < numNegativeSquares; i++) {
                let position, negativeValue;
                do {
                    position = getRandomInt(10, TOTAL_CELLS - 10);
                    negativeValue = getRandomInt(1, 6);
                } while (
                    negativeSquares.some(ns => ns.position === position) ||
                    snakes.some(s => s.start === position || s.end === position) ||
                    ladders.some(l => l.start === position || l.end === position)
                );
                negativeSquares.push({position, value: negativeValue});
                markNegativeSquare(position, negativeValue);
            }
            // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„Ù…ÙˆØ¬Ø¨Ø© (ØªÙ‚Ø¯Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨)
            const numPositiveSquares = getRandomInt(3, 6);
            for (let i = 0; i < numPositiveSquares; i++) {
                let position, positiveValue;
                do {
                    position = getRandomInt(10, TOTAL_CELLS - 10);
                    positiveValue = getRandomInt(1, 6);
                } while (
                    positiveSquares.some(ps => ps.position === position) ||
                    negativeSquares.some(ns => ns.position === position) ||
                    snakes.some(s => s.start === position || s.end === position) ||
                    ladders.some(l => l.start === position || l.end === position)
                );
                positiveSquares.push({position, value: positiveValue});
                markPositiveSquare(position, positiveValue);
            }
        }

        function drawConnection(start, end, type) {
            const startCell = document.getElementById(`cell-${start}`);
            const endCell = document.getElementById(`cell-${end}`);
            if (!startCell || !endCell) return;
            // Ø§Ø³ØªØ®Ø¯Ù… offsetLeft/offsetTop Ø§Ù„Ù†Ø³Ø¨ÙŠØ© Ù„Ù„Ø­Ø§ÙˆÙŠØ©
            const boardRect = board.getBoundingClientRect();
            const containerRect = document.getElementById('game-container').getBoundingClientRect();
            const startX = startCell.offsetLeft + startCell.offsetWidth / 2;
            const startY = startCell.offsetTop + startCell.offsetHeight / 2;
            const endX = endCell.offsetLeft + endCell.offsetWidth / 2;
            const endY = endCell.offsetTop + endCell.offsetHeight / 2;
            const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            svg.classList.add('connection', type);
            svg.setAttribute('width', Math.abs(endX - startX) + 10);
            svg.setAttribute('height', Math.abs(endY - startY) + 10);
            svg.style.position = 'absolute';
            svg.style.left = `${Math.min(startX, endX) - 5}px`;
            svg.style.top = `${Math.min(startY, endY) - 5}px`;
            svg.style.pointerEvents = 'none';
            svg.style.zIndex = 1;
            const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
            line.setAttribute('x1', startX < endX ? 5 : Math.abs(endX - startX) + 5);
            line.setAttribute('y1', startY < endY ? 5 : Math.abs(endY - startY) + 5);
            line.setAttribute('x2', startX < endX ? Math.abs(endX - startX) + 5 : 5);
            line.setAttribute('y2', startY < endY ? Math.abs(endY - startY) + 5 : 5);
            line.setAttribute('stroke', type === 'ladder' ? '#2ecc71' : '#e74c3c');
            line.setAttribute('stroke-width', '3');
            line.setAttribute('stroke-linecap', 'round');
            svg.appendChild(line);
            document.getElementById('game-container').appendChild(svg);
            // Ø¥Ø¶Ø§ÙØ© Ù†Øµ
            const label = document.createElement('div');
            label.classList.add('connection-label', `${type}-label`);
            label.textContent = `${start}â†’${end}`;
            label.style.position = 'absolute';
            label.style.left = `${Math.min(startX, endX) + Math.abs(endX - startX)/2 - 15}px`;
            label.style.top = `${Math.min(startY, endY) + Math.abs(endY - startY)/2 - 10}px`;
            label.style.backgroundColor = 'white';
            label.style.padding = '2px 5px';
            label.style.borderRadius = '3px';
            label.style.fontSize = '10px';
            label.style.fontWeight = 'bold';
            label.style.zIndex = 5;
            label.style.boxShadow = '0 0 3px rgba(0,0,0,0.2)';
            label.style.color = type === 'ladder' ? '#27ae60' : '#c0392b';
            label.style.border = type === 'ladder' ? '1px solid #27ae60' : '1px solid #c0392b';
            document.getElementById('game-container').appendChild(label);
        }

        function markNegativeSquare(position, value) {
            const cell = document.getElementById(`cell-${position}`);
            if (!cell) return;
            const negativeMarker = document.createElement('div');
            negativeMarker.classList.add('negative-square');
            negativeMarker.textContent = `-${value}`;
            negativeMarker.style.position = 'absolute';
            negativeMarker.style.top = '2px';
            negativeMarker.style.right = '2px';
            negativeMarker.style.background = '#ff4757';
            negativeMarker.style.color = 'white';
            negativeMarker.style.fontSize = '10px';
            negativeMarker.style.fontWeight = 'bold';
            negativeMarker.style.padding = '2px 4px';
            negativeMarker.style.borderRadius = '3px';
            negativeMarker.style.minWidth = '15px';
            negativeMarker.style.textAlign = 'center';
            negativeMarker.style.boxShadow = '0 1px 3px rgba(0,0,0,0.3)';
            negativeMarker.style.zIndex = '5';
            cell.style.backgroundColor = '#ffebee';
            cell.style.border = '2px solid #ff4757';
            cell.appendChild(negativeMarker);
        }

        function markPositiveSquare(position, value) {
            const cell = document.getElementById(`cell-${position}`);
            if (!cell) return;
            const positiveMarker = document.createElement('div');
            positiveMarker.classList.add('positive-square');
            positiveMarker.textContent = `+${value}`;
            positiveMarker.style.position = 'absolute';
            positiveMarker.style.top = '2px';
            positiveMarker.style.left = '2px';
            positiveMarker.style.background = '#2ecc71';
            positiveMarker.style.color = 'white';
            positiveMarker.style.fontSize = '10px';
            positiveMarker.style.fontWeight = 'bold';
            positiveMarker.style.padding = '2px 4px';
            positiveMarker.style.borderRadius = '3px';
            positiveMarker.style.minWidth = '15px';
            positiveMarker.style.textAlign = 'center';
            positiveMarker.style.boxShadow = '0 1px 3px rgba(0,0,0,0.3)';
            positiveMarker.style.zIndex = '5';
            cell.style.backgroundColor = '#e8f5e8';
            cell.style.border = '2px solid #2ecc71';
            cell.appendChild(positiveMarker);
        }

        // --- Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© ---
        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // --- Ø­Ø±ÙƒØ© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† (Ø£Ù†ÙŠÙ…ÙŠØ´Ù†) ---
        async function movePlayerSmoothly(player, targetPosition) {
            isMoving = true;
            rollButton.disabled = true;
            const playerElement = player === 1 ? player1Element : player2Element;
            const targetCell = document.getElementById(`cell-${targetPosition}`);
            // Ø§Ø³ØªØ®Ø¯Ù… offsetLeft/offsetTop Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† getBoundingClientRect
            const targetX = targetCell.offsetLeft + targetCell.offsetWidth / 2 - playerElement.offsetWidth / 2;
            const targetY = targetCell.offsetTop + targetCell.offsetHeight / 2 - playerElement.offsetHeight / 2;
            playerElement.style.left = `${targetX}px`;
            playerElement.style.top = `${targetY}px`;
            await new Promise(resolve => {
                playerElement.addEventListener('transitionend', resolve, { once: true });
            });
            playerPositions[player-1] = targetPosition;
            isMoving = false;
            rollButton.disabled = false;
        }

        async function movePlayerStepByStep(player, steps) {
            isMoving = true;
            rollButton.disabled = true;
            const playerElement = player === 1 ? player1Element : player2Element;
            let currentPos = playerPositions[player-1];
            const stepsToWin = TOTAL_CELLS - currentPos;
            let targetPosition;
            if (currentPos + steps > TOTAL_CELLS) {
                targetPosition = currentPos;
                statusElement.textContent = `Ø§Ù„Ù„Ø§Ø¹Ø¨ ${player} ÙŠØ­ØªØ§Ø¬ ${stepsToWin} Ø¨Ø§Ù„Ø¶Ø¨Ø· Ù„Ù„ÙÙˆØ²! (Ø±Ù…Ù‰ ${steps})`;
                await new Promise(resolve => setTimeout(resolve, 1500));
            } else {
                targetPosition = currentPos + steps;
            }
            for (let pos = currentPos + 1; pos <= targetPosition; pos++) {
                const targetCell = document.getElementById(`cell-${pos}`);
                const targetRect = targetCell.getBoundingClientRect();
                const boardRect = board.getBoundingClientRect();
                const targetX = targetRect.left - boardRect.left + targetRect.width / 2;
                const targetY = targetRect.top - boardRect.top + targetRect.height / 2;
                playerElement.style.left = `${targetX}px`;
                playerElement.style.top = `${targetY}px`;
                await new Promise(resolve => setTimeout(resolve, MOVE_DELAY));
                currentPos = pos;
            }
            playerPositions[player-1] = targetPosition;
            isMoving = false;
            rollButton.disabled = false;
            return targetPosition;
        }

        // --- Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø®Ø§ØµØ© ---
        function checkSnakeOrLadder(position) {
            for (const ladder of ladders) {
                if (ladder.start === position) {
                    return {type: 'ladder', to: ladder.end};
                }
            }
            for (const snake of snakes) {
                if (snake.start === position) {
                    return {type: 'snake', to: snake.end};
                }
            }
            return null;
        }

        function checkNegativeSquare(position) {
            for (const negSquare of negativeSquares) {
                if (negSquare.position === position) {
                    return {value: negSquare.value};
                }
            }
            return null;
        }

        function checkPositiveSquare(position) {
            for (const posSquare of positiveSquares) {
                if (posSquare.position === position) {
                    return {value: posSquare.value};
                }
            }
            return null;
        }

        async function processSpecialEffects(player, position, depth = 0) {
            if (depth > 5) return position;
            let currentPosition = position;
            let hasEffect = false;
            const snakeOrLadder = checkSnakeOrLadder(currentPosition);
            if (snakeOrLadder) {
                const message = snakeOrLadder.type === 'ladder' ? 
                    `ğŸš€ Ø§Ù„Ù„Ø§Ø¹Ø¨ ${player} ØµØ¹Ø¯ Ø¨Ø³Ù„Ù… Ù…Ù† ${currentPosition} Ø¥Ù„Ù‰ ${snakeOrLadder.to}!` : 
                    `ğŸ Ø§Ù„Ù„Ø§Ø¹Ø¨ ${player} Ø§Ù†Ø²Ù„Ù‚ Ø¨Ø«Ø¹Ø¨Ø§Ù† Ù…Ù† ${currentPosition} Ø¥Ù„Ù‰ ${snakeOrLadder.to}!`;
                statusElement.textContent = message;
                await new Promise(resolve => setTimeout(resolve, 1000));
                await movePlayerSmoothly(player, snakeOrLadder.to);
                currentPosition = snakeOrLadder.to;
                hasEffect = true;
            }
            if (hasEffect) {
                return await processSpecialEffects(player, currentPosition, depth + 1);
            }
            return currentPosition;
        }
        
        // Ø¹Ù†Ø§ØµØ± DOM
        const board = document.getElementById('board');
        const statusElement = document.getElementById('status');
        const diceElement = document.getElementById('dice');
        const rollButton = document.getElementById('roll');
        const resetButton = document.getElementById('reset');
        const player1Element = document.getElementById('player1');
        const player2Element = document.getElementById('player2');
        
        // Ø¯ÙˆØ§Ù„ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨
        function showNameInput() {
            const welcomeScreen = document.getElementById('welcomeScreen');
            const nameInputScreen = document.getElementById('nameInputScreen');
            
            welcomeScreen.style.display = 'none';
            nameInputScreen.style.display = 'flex';
        }
        
        function showWelcome() {
            const welcomeScreen = document.getElementById('welcomeScreen');
            const gameContent = document.getElementById('gameContent');
            const nameInputScreen = document.getElementById('nameInputScreen');
            
            gameContent.style.display = 'none';
            nameInputScreen.style.display = 'none';
            welcomeScreen.style.display = 'flex';
            
            // Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…
            socket.disconnect();
        }
        
        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¥Ù„Ù‰ Ø§Ù„ØºØ±ÙØ©
        function joinRoom() {
            const playerName = document.getElementById('playerName').value.trim();
            const roomIdInput = document.getElementById('roomId').value.trim();
            
            if (!playerName) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨');
                return;
            }
            
            if (!roomIdInput) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„ØºØ±ÙØ©');
                return;
            }
            
            myPlayerName = playerName;
            roomId = roomIdInput;
            
            // Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¥Ù„Ù‰ Ø§Ù„ØºØ±ÙØ©
            socket.emit('joinRoom', {
                roomId: roomId,
                playerName: playerName
            });
        }
        
        // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…
        socket.on('joinedRoom', (data) => {
            console.log('Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ø§Ù„ØºØ±ÙØ©:', data);
            players = data.room.players;
            myPlayerNumber = data.player.number;
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØºØ±ÙØ©
            showRoomInfo(data.room, data.player);
        });
        
        socket.on('playerJoined', (data) => {
            console.log('Ø§Ù†Ø¶Ù… Ù„Ø§Ø¹Ø¨ Ø¬Ø¯ÙŠØ¯:', data);
            players = data.players;
            
            // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØºØ±ÙØ©
            updateRoomInfo(data.players);
        });
        
        socket.on('roomFull', (data) => {
            alert('Ø§Ù„ØºØ±ÙØ© Ù…Ù…ØªÙ„Ø¦Ø© Ø¨Ø§Ù„ÙØ¹Ù„. ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØºØ±ÙØ© Ø£Ø®Ø±Ù‰.');
        });
        
        socket.on('gameReady', (data) => {
            console.log('Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¬Ø§Ù‡Ø²Ø©:', data);
            
            // Ø¥Ø®ÙØ§Ø¡ ÙˆØ§Ø¬Ù‡Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù…
            document.getElementById('nameInputScreen').style.display = 'none';
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù„Ø¹Ø¨Ø©
            const gameContent = document.getElementById('gameContent');
            gameContent.style.display = 'block';
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
            initializeGame(data.gameState, data.board);
        });
        
        socket.on('diceRolled', (data) => {
            console.log('ØªÙ… Ø±Ù…ÙŠ Ø§Ù„Ù†Ø±Ø¯:', data);
            diceElement.textContent = data.diceValue;
            
            if (data.player === myPlayerNumber) {
                statusElement.textContent = `Ø±Ù…ÙŠØª ${data.diceValue}`;
            } else {
                statusElement.textContent = `Ø§Ù„Ù„Ø§Ø¹Ø¨ ${data.player} Ø±Ù…Ù‰ ${data.diceValue}`;
            }
        });
        
        socket.on('playerMoved', (data) => {
            console.log('ØªØ­Ø±Ùƒ Ø§Ù„Ù„Ø§Ø¹Ø¨:', data);
            
            // ØªØ­Ø¯ÙŠØ« Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
            playerPositions = data.gameState.playerPositions;
            updatePlayerPositions();
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
            updateGameState(data.gameState);
        });
        
        socket.on('turnChanged', (data) => {
            console.log('ØªØºÙŠØ± Ø§Ù„Ø¯ÙˆØ±:', data);
            currentPlayer = data.currentPlayer;
            
            if (currentPlayer === myPlayerNumber) {
                statusElement.textContent = 'Ø¯ÙˆØ±Ùƒ! Ø§Ø±Ù… Ø§Ù„Ù†Ø±Ø¯';
                rollButton.disabled = false;
            } else {
                statusElement.textContent = `Ø¯ÙˆØ± Ø§Ù„Ù„Ø§Ø¹Ø¨ ${currentPlayer}`;
                rollButton.disabled = true;
            }
        });
        
        socket.on('gameOver', (data) => {
            console.log('Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©:', data);
            gameOver = true;
            
            if (data.winner === myPlayerNumber) {
                statusElement.textContent = 'ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! ÙØ²Øª! ğŸ‰';
            } else {
                statusElement.textContent = `Ø§Ù„Ù„Ø§Ø¹Ø¨ ${data.winner} ÙØ§Ø²!`;
            }
            
            rollButton.disabled = true;
        });
        
        socket.on('gameReset', (data) => {
            console.log('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù„Ø¹Ø¨Ø©:', data);
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù„Ø¹Ø¨Ø©
            resetGameState(data.gameState);
        });
        
        socket.on('playerLeft', (data) => {
            console.log('ØºØ§Ø¯Ø± Ù„Ø§Ø¹Ø¨:', data);
            players = data.players;
            
            if (players.length === 1) {
                statusElement.textContent = 'ØºØ§Ø¯Ø± Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø¢Ø®Ø±. Ø§Ù†ØªØ¸Ø§Ø± Ù„Ø§Ø¹Ø¨ Ø¬Ø¯ÙŠØ¯...';
                rollButton.disabled = true;
            }
        });
        
        // Ø¯Ø§Ù„Ø© Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØºØ±ÙØ©
        function showRoomInfo(room, player) {
            const nameInputScreen = document.getElementById('nameInputScreen');
            const inputContainer = nameInputScreen.querySelector('.input-container');
            
            inputContainer.innerHTML = `
                <h2>ğŸ® ØºØ±ÙØ© Ø§Ù„Ù„Ø¹Ø¨ ${room.id}</h2>
                
                <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; margin: 20px 0;">
                    <h3>Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ† ÙÙŠ Ø§Ù„ØºØ±ÙØ©:</h3>
                    <div style="display: flex; justify-content: center; gap: 20px; margin: 20px 0;">
                        ${room.players.map(p => `
                            <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px; min-width: 150px;">
                                <div>ğŸ‘¤ ${p.name}</div>
                                <div>Ø§Ù„Ù„Ø§Ø¹Ø¨ ${p.number}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                ${room.players.length === 1 ? 
                    '<div style="font-size: 1.2em; margin: 20px 0; color: #FFD700;">â³ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ø§Ø¹Ø¨ Ø¢Ø®Ø±...</div>' : 
                    '<div style="font-size: 1.2em; margin: 20px 0; color: #FFD700;">ğŸ® Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø¨Ø¯Ø¡!</div>'
                }
                
                <button class="join-button" onclick="leaveRoom()">Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„ØºØ±ÙØ©</button>
            `;
        }
        
        // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØºØ±ÙØ©
        function updateRoomInfo(playersList) {
            const playerListElement = document.querySelector('.player-list');
            if (playerListElement) {
                playerListElement.innerHTML = playersList.map(p => `
                    <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px; min-width: 150px;">
                        <div>ğŸ‘¤ ${p.name}</div>
                        <div>Ø§Ù„Ù„Ø§Ø¹Ø¨ ${p.number}</div>
                    </div>
                `).join('');
            }
            
            const waitingMessage = document.querySelector('.waiting-message');
            if (waitingMessage) {
                waitingMessage.textContent = playersList.length === 1 ? 
                    'â³ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ø§Ø¹Ø¨ Ø¢Ø®Ø±...' : 
                    'ğŸ® Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø¨Ø¯Ø¡!';
            }
        }
        
        // Ø¯Ø§Ù„Ø© Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„ØºØ±ÙØ©
        function leaveRoom() {
            socket.disconnect();
            showWelcome();
        }
        
        // Ø¯Ø§Ù„Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
        function initializeGame(gameState, boardData) {
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
            currentPlayer = gameState.currentPlayer;
            playerPositions = gameState.playerPositions;
            gameOver = gameState.gameOver;
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„ÙˆØ­Ø©
            initializeBoard();
            generateSnakesAndLadders();
            updatePlayerPositions();
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
            updateGameState(gameState);
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            if (currentPlayer === myPlayerNumber && !gameOver) {
                statusElement.textContent = 'Ø¯ÙˆØ±Ùƒ! Ø§Ø±Ù… Ø§Ù„Ù†Ø±Ø¯';
                rollButton.disabled = false;
            } else if (!gameOver) {
                statusElement.textContent = `Ø¯ÙˆØ± Ø§Ù„Ù„Ø§Ø¹Ø¨ ${currentPlayer}`;
                rollButton.disabled = true;
            }
        }
        
        // Ø¯Ø§Ù„Ø© Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
        function resetGameState(gameState) {
            currentPlayer = gameState.currentPlayer;
            playerPositions = gameState.playerPositions;
            gameOver = gameState.gameOver;
            
            // Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø§Ù„Ù„ÙˆØ­Ø©
            initializeBoard();
            generateSnakesAndLadders();
            updatePlayerPositions();
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
            updateGameState(gameState);
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            if (currentPlayer === myPlayerNumber && !gameOver) {
                statusElement.textContent = 'Ø¯ÙˆØ±Ùƒ! Ø§Ø±Ù… Ø§Ù„Ù†Ø±Ø¯';
                rollButton.disabled = false;
            } else if (!gameOver) {
                statusElement.textContent = `Ø¯ÙˆØ± Ø§Ù„Ù„Ø§Ø¹Ø¨ ${currentPlayer}`;
                rollButton.disabled = true;
            }
        }
        
        // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
        function updateGameState(gameState) {
            currentPlayer = gameState.currentPlayer;
            playerPositions = gameState.playerPositions;
            gameOver = gameState.gameOver;
            
            if (gameOver) {
                rollButton.disabled = true;
            }
        }
        
        // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
        function updatePlayerPositions() {
            const startCell = document.getElementById('cell-1');
            const startRect = startCell.getBoundingClientRect();
            const boardRect = board.getBoundingClientRect();
            
            // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø£ÙˆÙ„
            if (playerPositions[0] > 1) {
                const cell1 = document.getElementById(`cell-${playerPositions[0]}`);
                const rect1 = cell1.getBoundingClientRect();
                const x1 = rect1.left - boardRect.left + rect1.width / 2;
                const y1 = rect1.top - boardRect.top + rect1.height / 2;
                player1Element.style.left = `${x1}px`;
                player1Element.style.top = `${y1}px`;
            } else {
                const startX = startRect.left - boardRect.left + startRect.width / 2;
                const startY = startRect.top - boardRect.top + startRect.height / 2;
                player1Element.style.left = `${startX}px`;
                player1Element.style.top = `${startY}px`;
            }
            
            // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø«Ø§Ù†ÙŠ
            if (playerPositions[1] > 1) {
                const cell2 = document.getElementById(`cell-${playerPositions[1]}`);
                const rect2 = cell2.getBoundingClientRect();
                const x2 = rect2.left - boardRect.left + rect2.width / 2;
                const y2 = rect2.top - boardRect.top + rect2.height / 2;
                player2Element.style.left = `${x2}px`;
                player2Element.style.top = `${y2}px`;
            } else {
                const startX = startRect.left - boardRect.left + startRect.width / 2;
                const startY = startRect.top - boardRect.top + startRect.height / 2;
                player2Element.style.left = `${startX}px`;
                player2Element.style.top = `${startY}px`;
            }
        }
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„ÙˆØ­Ø©
        function initializeBoard() {
            board.innerHTML = '';
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù„ÙˆØ­Ø© Ø¨ØªØ±ØªÙŠØ¨ Ù…ØªØ¹Ø±Ø¬
            for (let row = 10; row >= 1; row--) {
                const tr = document.createElement('tr');
                
                const isReverseRow = row % 2 === 0;
                const colsOrder = isReverseRow ? 
                    Array.from({length: 10}, (_, i) => 10 - i) : 
                    Array.from({length: 10}, (_, i) => i + 1);
                
                for (const col of colsOrder) {
                    const cellNumber = (row - 1) * 10 + col;
                    const td = document.createElement('td');
                    td.textContent = cellNumber;
                    td.id = `cell-${cellNumber}`;
                    tr.appendChild(td);
                }
                
                board.appendChild(tr);
            }
        }
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        rollButton.addEventListener('click', () => {
            if (currentPlayer === myPlayerNumber && !gameOver) {
                socket.emit('rollDice');
                rollButton.disabled = true;
            }
        });
        
        resetButton.addEventListener('click', () => {
            socket.emit('resetGame');
        });
        
        // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ù„Ø¶ØºØ· Enter ÙÙŠ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
        document.getElementById('playerName').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                document.getElementById('roomId').focus();
            }
        });
        
        document.getElementById('roomId').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                joinRoom();
            }
        });
    </script>
</body>
 